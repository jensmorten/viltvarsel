# --- Konfigurasjon ---
# Lim inn hele WKT-strengen mellom de tre anførselstegnene under:
wkt = """LINESTRING Z (307939.064 7205345.661 23.75,307947.144 7205349.531 23.4,307956.13 7205353.449 22.73,307968.91 7205359.48 21.93,307980.954 7205364.848 20.74,307996.22 7205371.52 19.83,308009.75 7205377.27 19.03,308022.89 7205382.211 18.55,308035.3 7205387.1 18.21,308046.6 7205392.3 18.21,308053.2 7205396.7 18.41,308059.9 7205402.399 18.51,308068.1 7205410.8 18.71,308079.2 7205422.8 19.31,308093.4 7205438 19.51,308107.7 7205453 19.51,308122.3 7205468.2 19.41,308135.278 7205481.703 19.11,308145.5 7205492.9 18.71,308156.9 7205505 18.31,308169.4 7205517.899 18.31,308170.8 7205519.3 18.21,308178.8 7205527.601 18.21,308189 7205538.3 18.31,308200.4 7205549.399 18.71,308210.2 7205558.3 18.81,308221 7205568 19.21,308234 7205578.601 19.71,308246.7 7205589 20.11,308260.3 7205599.7 20.21,308276.6 7205612.7 20.41,308289.5 7205623 20.61,308304.1 7205634.601 20.81,308316.8 7205644.899 20.91,308329.7 7205655.2 21.31,308343.2 7205666 21.61,308356.4 7205676.601 21.71,308368.2 7205686 21.71,308379.3 7205694.899 21.81,308391.6 7205704.601 21.81,308404 7205714.5 21.61,308416.5 7205724.601 21.51,308428.7 7205734.2 21.41,308439.3 7205742.8 21.71,308448.2 7205750.101 22.01,308456.5 7205757.5 22.61,308464.1 7205765.5 23.01,308470.7 7205773.899 23.51,308475.5 7205781.899 24.11,308480.6 7205790.8 24.41,308485.1 7205800.5 24.71,308490.4 7205812.399 24.61,308496.5 7205826.2 24.71,308502.4 7205838.7 24.31,308508.1 7205849.8 23.81,308513.8 7205859.2 23.01,308519.5 7205867.3 22.31,308524.8 7205874.101 21.71,308530.1 7205880 21.01,308535.5 7205885.7 20.21,308541.9 7205891.3 19.51,308550.9 7205898 18.31,308561.3 7205905.399 17.01,308575.1 7205915 15.51,308589.7 7205925.3 13.91,308603.9 7205935.601 12.41,308617.2 7205945.3 11.61,308630.4 7205955.2 10.81,308640.7 7205962.7 10.31,308649.6 7205969.9 10.11,308659 7205978 9.81,308667.6 7205986.1 9.71,308675.4 7205994.3 9.81,308684.3 7206004.6 10.31,308691.9 7206014.5 10.71,308699.2 7206024.6 11.01,308705 7206034.2 11.51,308710.7 7206044 12.71,308716.4 7206054.7 13.71,308721.8 7206066.1 15.01,308725.7 7206076.1 16.11,308729.3 7206086.4 16.81,308732.3 7206096.7 17.51,308735.5 7206107.9 18.21,308738.8 7206120.1 18.71,308741.9 7206133.7 19.51,308745.5 7206148.1 20.31,308748.5 7206161.7 20.71,308751.2 7206174.5 21.51,308751.895 7206177.704 21.644,308753.8 7206186.5 22.01,308756.9 7206200.2 22.81,308759.8 7206212.7 23.61,308763.46 7206226.73 24.5,308766.41 7206241.2 25.67,308769.92 7206254 26.15,308773.91 7206266.41 26.7,308778.2 7206278.57 27.3,308783.14 7206290.51 27.51,308789.36 7206302.93 27.74,308795.73 7206314.42 28.16,308801.45 7206323.97 28.59,308807.15 7206332.13 28.67,308814.45 7206341.46 28.61,308822.71 7206351.72 28.91,308832.189 7206363.73 29.51,308841.22 7206375.101 30.32,308852.23 7206388.19 31.16,308863.1 7206401.66 32.27,308874.74 7206415.891 33.27,308883.72 7206426.96 34.17,308892.689 7206437.87 34.85,308899.85 7206445.53 35.08,308906.5 7206452.391 35.78,308913.13 7206458.29 36.45,308920.91 7206464.641 37.08,308927.47 7206469.31 37.68,308935.02 7206474.33 38.5,308942.36 7206478.77 39.37,308951.26 7206483.84 40.29,308960.95 7206489.42 40.89,308971.15 7206495.72 41.71,308980.9 7206502.52 43.09,308992.92 7206511.12 43.87,309003.55 7206519.21 44.89,309018.35 7206530.77 46.12,309031.9 7206541.55 47.15,309046.57 7206553.16 47.99,309059.859 7206563.391 48.96,309073.27 7206573.38 49.53,309083.42 7206581.49 50.11,309092.84 7206589.399 50.69,309101.79 7206597.52 51.14,309110.75 7206606.57 51.83,309121.07 7206617.23 52.03,309133.17 7206630.359 52.69,309147.42 7206646.05 53.61,309160.48 7206660.83 54.74,309173.061 7206675.08 55.68,309185.939 7206689.57 56.62,309196.63 7206701.83 57.68,309204.41 7206710.56 58.09,309210.47 7206718.68 59.08,309215.26 7206726.359 59.68,309219.83 7206735.109 60.37,309223.21 7206743.31 60.811,309226 7206751.75 61.28,309228.439 7206760.41 61.901,309231.47 7206775.16 62.531,309235.29 7206792.02 63.111,309239.24 7206810.63 63.541,309243.58 7206827.95 63.751,309248.05 7206842.351 63.971,309252.59 7206853.891 63.491,309254.59 7206857.94 63.19,309257.93 7206864.9 63.341,309263.391 7206873.97 62.251,309268.96 7206883.06 61.361,309275.51 7206892.55 60.171,309284.9 7206905.351 58.311,309295.75 7206920.29 55.881,309304.91 7206932.97 53.911,309311.98 7206943.399 52.601,309318.73 7206953.851 50.901,309324.62 7206963.32 49.401,309330.29 7206973.69 47.951,309334.939 7206982.99 46.771,309340.08 7206994.26 45.291,309345.65 7207007.34 43.921,309352.42 7207024.96 42.041,309358.359 7207041.09 40.511,309366.939 7207063.851 38.391,309373.5 7207081.58 37.091,309379.12 7207097.19 35.981,309383.96 7207109.75 34.901,309388.92 7207123.07 33.621,309394.561 7207138.641 31.901,309400.35 7207154.78 30.441,309406.25 7207170.31 29.031,309412.55 7207187.19 27.611,309418.7 7207204.27 26.591,309424.8 7207220.859 25.261,309431.07 7207237.44 23.921,309437.79 7207255.48 22.211,309444.59 7207273.859 20.351,309450.77 7207290.32 18.741,309457.09 7207306.891 17.411,309463.73 7207324.18 16.061,309469.77 7207341.101 15.111,309474.75 7207355.71 14.481,309478.48 7207366.94 14.301,309481.311 7207377.851 14.211,309484 7207389.92 14.071,309485.77 7207401.721 14.051,309487.23 7207414.88 13.901,309488.47 7207428.16 13.811,309489.48 7207441.47 14.001,309490.67 7207455.96 13.961,309491.5 7207468.351 14.041,309492.34 7207481.109 14.101,309493.09 7207494.23 14.001,309493.891 7207512.42 13.591,309494.75 7207530.21 13.351,309495.79 7207547.93 13.251,309496.98 7207561.31 13.241,309498.83 7207574.46 13.171,309500.77 7207585.92 13.251,309503.23 7207598.51 13.291,309505.7 7207609.56 13.101,309508.891 7207622.24 13.191,309512.35 7207634.2 13.111,309515.189 7207643.52 13.281,309519.73 7207657.34 13.371,309525.74 7207674.641 13.291,309533.21 7207695.75 12.991,309539.4 7207713.23 12.921,309546.04 7207732.06 12.871,309552.73 7207751.13 13.031,309560.16 7207772.601 13.181,309566.22 7207790.31 13.031,309572.04 7207807.09 13.281,309576.83 7207820.56 13.191,309583.359 7207835.41 12.951,309591.54 7207852.75 12.951,309600 7207870.33 13.121,309604.99 7207883.19 13.391,309606.42 7207887.89 13.33,309608.42 7207896.01 13.531,309610.88 7207909.899 13.371,309612.35 7207922.75 13.351,309614.27 7207938.97 12.861,309616.24 7207956.649 12.201,309618.18 7207975.601 11.681,309619.14 7207983.79 11.541,309619.95 7207990.559 11.431,309620.5 7207995.29 11.351,309622.25 7208013 11.081,309624.37 7208032.78 10.801,309626.38 7208051.06 10.751,309627.72 7208065.44 10.741,309628.78 7208078.06 10.831,309629.33 7208089.649 10.921,309629.67 7208101.67 10.831,309629.49 7208113.29 10.751,309628.95 7208126.43 10.561,309627.29 7208143.72 10.471,309625.58 7208162.52 10.331,309624.72 7208177.16 10.471,309624.5 7208189.88 10.551,309625.1 7208201.8 10.531,309626.76 7208216.26 10.481,309629.07 7208236.23 10.171,309631.09 7208254.09 9.801,309633.8 7208276.07 9.611,309636.4 7208299.17 9.381,309639.07 7208322.899 8.962,309642.061 7208348.19 8.512,309644.33 7208367.2 8.442,309647.04 7208386.52 8.252,309649.54 7208401.25 8.052,309651.99 7208411.55 7.692,309654.72 7208420.02 7.602,309659.859 7208432.57 7.312,309665.15 7208443.44 7.232,309671.63 7208455.25 6.952,309677.283 7208464.58 6.694,309678.78 7208467 6.142,309686.16 7208477.09 5.572,309694.42 7208487.07 5.052,309703.12 7208496.34 4.752,309711.97 7208504.899 4.452,309721.41 7208512.98 4.492,309732.88 7208521.649 4.552,309741.9 7208527.649 4.692,309750.891 7208533.03 4.812,309762.13 7208539.04 5.112,309774.43 7208545.08 5.622,309795.91 7208555.78 6.212,309817.359 7208566.75 6.532,309835.04 7208575.54 7.002,309852.4 7208584.5 6.642,309868.08 7208592.79 6.372,309882.74 7208600.57 5.972,309897.18 7208608.601 5.692,309907.34 7208614.42 5.3,309914.52 7208618.21 5.492,309932.3 7208627.99 5.682,309950.05 7208638.12 5.892,309969.91 7208649.48 6.432,309992.74 7208662.37 7.342,310014.3 7208674.69 7.982,310034.12 7208686 8.512,310052.84 7208696.54 8.482,310066.061 7208703.78 8.352,310077.45 7208709.37 8.172,310085.84 7208713.12 8.042,310096.09 7208716.99 7.462,310105.87 7208720.06 6.812,310116.71 7208722.42 6.122,310127.96 7208723.69 5.422,310140.29 7208724.34 4.742,310150.48 7208724.16 4.092,310163.08 7208722.95 3.882,310183.061 7208719.891 3.832,310197.109 7208717.37 3.872,310211.891 7208714.68 3.952,310227.38 7208711.81 3.812,310243.6 7208709.33 3.712,310264.75 7208706.63 3.232,310282.03 7208704.98 3.052,310298.7 7208703.56 2.932,310317.391 7208701.78 2.972,310338.3 7208699.53 2.932,310355.25 7208698.18 3.072,310374.939 7208696.45 3.472,310390.35 7208694.97 4.202,310408.57 7208693.33 5.132,310425.87 7208691.641 5.962,310444.811 7208689.95 6.812,310460.93 7208688.46 7.842,310477.09 7208687.16 9.032,310490.07 7208685.85 9.832,310497 7208685.101 10.312,310512 7208683.399 10.812,310519.962 7208682.277 11.012,310524.6 7208681.601 11.412,310535.9 7208679.399 11.812,310546.6 7208676.601 12.112,310556.4 7208673.3 12.312,310567.4 7208668.8 12.512,310580.9 7208662.601 12.812,310595.4 7208655.8 13.312,310610.9 7208648.8 13.812,310624.2 7208642.601 14.512,310638.7 7208636.101 14.612,310650.5 7208630.601 14.912,310663.3 7208624.8 14.912,310676.5 7208617.899 15.012,310689.8 7208611.899 15.012,310703.1 7208607.101 15.212,310717.4 7208602.2 15.312,310730.9 7208599 15.712,310744.6 7208596.399 16.312,310757 7208595.2 16.812,310770.2 7208594.399 17.412,310783.2 7208594.7 18.112,310795.4 7208595.601 19.012,310805.6 7208596.899 19.412,310815.7 7208598.399 19.512,310826.4 7208601.101 19.812,310837.1 7208604 20.312,310850.5 7208608.399 20.812,310863.7 7208612.601 21.412,310879.9 7208617.899 21.912,310894.2 7208622.5 22.312,310907.2 7208627 22.812,310922.5 7208632 23.312,310938.8 7208637.399 23.612,310954 7208642.101 23.912,310967.9 7208646.7 24.012,310980.9 7208651.2 23.912,310994.1 7208655.399 24.012,311009.1 7208660.3 24.012,311023.5 7208665.7 24.112,311034.5 7208670.899 24.112,311042.8 7208675.399 23.912,311050.6 7208680.601 23.712,311059.1 7208687.101 23.412,311065.5 7208692.899 22.713,311070.9 7208698.8 22.113,311076.1 7208704.899 21.213,311082.4 7208713.3 20.513,311089.3 7208723.8 19.613,311096.8 7208736.8 18.513,311104.2 7208750.8 17.913,311111.6 7208764.5 17.713,311118.5 7208778 17.713,311124.4 7208789 17.813,311128.9 7208799.3 17.913,311132.2 7208807.601 17.613,311135.6 7208817 17.413,311138.2 7208826.5 17.113,311140.3 7208837.2 16.513,311142.1 7208849.899 15.713,311143.3 7208862.899 14.913,311143.5 7208875.899 14.413,311143.1 7208886.399 13.913,311142 7208896.101 13.813,311140.3 7208905.8 13.413,311138.1 7208917.2 13.313,311134.9 7208931 13.313,311131.4 7208946.8 13.213,311127.9 7208962.899 13.213,311124.7 7208977.101 13.213,311121 7208993.2 13.013,311116.7 7209011.7 12.813,311113 7209028.2 12.613,311109.6 7209043.8 12.613,311106 7209058.899 12.413,311102.8 7209073.101 12.213,311099 7209085.899 12.213,311096.1 7209093.5 12.213,311092.2 7209101.601 12.113,311086.3 7209111.8 11.913,311080.9 7209120 11.713,311075.1 7209127.2 11.613,311068.6 7209134.399 11.413,311063.786 7209139.309 11.127,311052.37 7209151 10.39,311036.36 7209167.52 8.89,311033.8 7209170.101 8.813,311022.7 7209182.101 7.913,311017 7209188.325 7.57,311009.336 7209196.566 7.113)"""

# Sett kilde-CRS her: UTM sone 33N (Trøndelag). Om nødvendig, bytt til 32632.
src_epsg = 32633

# --- Biblioteker ---
import folium
from pyproj import Transformer
import branca.colormap as cm

# --- 1) Parse WKT (enkel parser for LINESTRING og LINESTRING Z) ---
def parse_linestring_wkt(wkt_text):
    w = wkt_text.strip()
    # Finn innholdet innenfor første par med parenteser
    start = w.find('(')
    end = w.rfind(')')
    if start == -1 or end == -1:
        raise ValueError("Ugyldig WKT: mangler parenteser")
    body = w[start+1:end].strip()

    coords = []
    for part in body.split(','):
        nums = part.strip().split()
        if len(nums) < 2:
            continue
        x = float(nums[0]); y = float(nums[1])
        z = float(nums[2]) if len(nums) >= 3 else None
        coords.append((x, y, z))
    return coords

pts_xyz = parse_linestring_wkt(wkt)

# --- 2) Transformér til WGS84 (EPSG:4326) ---
# Merk: always_xy=True => input (x=easting, y=northing) og output (lon, lat)
transformer = Transformer.from_crs(src_epsg, 4326, always_xy=True)
lonlatz = [( *transformer.transform(x, y), z ) for (x, y, z) in pts_xyz]
lats_lons = [(lat, lon) for (lon, lat, z) in lonlatz]
zs = [z for (_, _, z) in lonlatz if z is not None]

# --- 3) Lag Folium-kart ---
# Start i midtpunktet
mid = lats_lons[len(lats_lons)//2]
m = folium.Map(location=mid, zoom_start=12, tiles="OpenStreetMap")

# Valg A: enkel rød linje
folium.PolyLine(lats_lons, color="red", weight=4, opacity=0.9).add_to(m)

# Start / slutt
folium.Marker(lats_lons[0], tooltip="Start").add_to(m)
folium.Marker(lats_lons[-1], tooltip="Slutt").add_to(m)

# Zoom til geometrien
m.fit_bounds(lats_lons)

# --- 4) (Valgfritt) Farge etter høyde Z ---
# Kommenter UT denne blokken hvis du ikke vil segmentere etter høyde
if zs:
    # Fjern den enkle røde linjen (eller bare la begge være)
    # For mer ryddig: ikke tegn rød linje over — kommenter bort PolyLine over
    m = folium.Map(location=mid, zoom_start=12, tiles="OpenStreetMap")
    vmin, vmax = min(zs), max(zs)
    cmap = cm.LinearColormap(["#2c7bb6", "#abd9e9", "#ffffbf", "#fdae61", "#d7191c"], vmin=vmin, vmax=vmax)
    cmap.caption = "Høyde (meter)"
    cmap.add_to(m)

    # Tegn hvert segment med farge basert på midlere Z
    for i in range(len(lats_lons)-1):
        (lat1, lon1), (lat2, lon2) = lats_lons[i], lats_lons[i+1]
        z1 = lonlatz[i][2]; z2 = lonlatz[i+1][2]
        z_mid = None
        if z1 is not None and z2 is not None:
            z_mid = 0.5*(z1 + z2)
        color = cmap(z_mid) if z_mid is not None else "gray"
        folium.PolyLine([(lat1, lon1), (lat2, lon2)], color=color, weight=5, opacity=0.95).add_to(m)

    folium.Marker(lats_lons[0], tooltip=f"Start ({zs[0]:.1f} m)").add_to(m)
    folium.Marker(lats_lons[-1], tooltip=f"Slutt ({zs[-1]:.1f} m)").add_to(m)
    m.fit_bounds(lats_lons)

# Lagre som HTML
m.save("veg_trondelag.html")
print("Ferdig! Åpne filen 'veg_trondelag.html' i nettleseren.")